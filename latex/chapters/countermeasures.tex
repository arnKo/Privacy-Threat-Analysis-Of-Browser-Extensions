% !TeX spellcheck = en_US

\chapter{Countermeasures}


\section{Detect Malicious Behavior}
	
	Mozilla reviews Add-ons that they publish on the official web store by their security experts to reject malicious implementations. This could also be done for the cross-browser extensions. Indeed, a research team already developed a system called \textit{WebEval} to identify malicious extensions. For three yeas, they collected each version of all extensions published to the Chrome Web Store and fed them into their system. They detected about 9,000 malicious extensions which were nearly 10\% of all analyzed extensions. Furthermore, WebEval uses a machine learning algorithm to evaluate each extension and potential malicious findings are verified by human experts. The researchers measured the overall accuracy of their system which increased over time although they experienced drops in the accuracy when new threats emerged. \\
	A disadvantage of WebEval is that it executes the extensions in a sandboxed environment. Therefore, not all malicious interactions with web content can be monitored. For example, the system has no account creation on-the-fly and is therefore not able to analyze the extension's behavior on account-restricted web pages.
	
	Other researchers developed systems to monitor the flow of sensitive information in JavaScript-base applications such as extensions \cite{Dhawan:2009:AIF:1723192.1723250, Hallaraker:2005:DMJ:1078029.1078861, cs2015sentinel,ndss2007xss}. They blocked the flow if sensitive information are transfered to untrusted targets such as remote servers. All approaches modify the browser's JavaScript interpreter to enable the tracking.

\section{Improved Permissions}

	Another strategy to increase the privacy of a user was proposed by Liu et al. \cite{Liu12chromeextensions:}. They conducted a threat analysis of Chrome extensions and discovered that the extension's unrestricted access to the web page and the possibility to execute unrestricted web requests posse the most harm to the user's privacy. As we showed ourselves, a malicious extension is able to extract and transfer sensitive user information from any web page that the user visits using only a single content script. The researchers stated that the current permission system does not comply to the principle of least privileges and proposed a modified permission system to mitigate the found threats. 
	
	The extension's components namely the background and content scripts share the same set of permissions declared in the manifest. This leads to some components having permissions they do not need and therefore not being least-privileged. If the extension requests host permissions for a particular origin, the extension's background is allowed to inject scripts in matching web pages and both - the background and content scripts - are allowed to execute web requests to the origin. Liu et al. proposed separated permission sets for each component and to split host permissions based on particular operations such as to inject a script or execute a web request. However, a content script is still able to execute unrestricted web requests by adding an element to the DOM that fetches a resource from a remote origin. We also used this condition in our design to execute a request to our remote server. To mitigate this threat, the researchers proposed an additional permission that restricts a content script and allows that only listed origins can be added as sources to the DOM.
	
	An extension's content script has unrestricted access to the web page and its content. This allows a malicious extension to extract sensitive information. Liu et al. proposed a categorization of DOM elements to identify container of sensitive information and restricted access to these elements by default. \textit{High level} elements such as input elements of type password or hidden contain inherently sensitive information. \textit{Medium level} elements may contain sensitive information. To identify these elements, the researchers proposed a catalog with regular expressions that match code words such as \textit{username}. Finally, every element else is categorized as \textit{low level}. By default, an extension should have only access to low level elements and the extension may request access to the other levels by a proper permission.