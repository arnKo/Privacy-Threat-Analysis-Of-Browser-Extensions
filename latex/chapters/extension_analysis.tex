% !TeX spellcheck = en_US

\chapter{Extension Analysis}
	
	We want to show that our implementation is indeed applicable to real world extensions. Therefore, we evaluated the permissions of popular extensions and analyzed which of our implemented components we can integrate into them. For that purpose, we compared the extension's declared permissions with the permissions needed for our components. 
	
	We fetched the extensions from the Google Chrome Web Store. Unfortunately, the web store does not provide the functionality to sort extension based on the amount of current users. Furthermore, the shown number of current users is cut if it is higher than 10,000,000. Therefore, we had to manually search through the web store and select extensions to evaluate ourself. 
	
	In this section we present the results of our extension analysis. The table shown in \autoref{tab:extensionSummary} provides an overview of analyzed extensions.
	
	\begin{table}[h]
		\centering
		\begin{tabular}{|l|l|l|} \hline
			\textbf{Extension} & \textbf{Version} & \textbf{Amount Users} \\ \hline
			Google Translate & 2.0.6 & 6,049,594 \\ 
			Unlimited Free VPN - Hola & 1.11.973 & 8,419,372 \\ \hline
		\end{tabular}
		\caption{Summary of analyzed extension}
		\label{tab:extensionSummary}
	\end{table}
	
	
\section{Google Translate}
	This extension provides several features to translate single words up to whole pages. It adds a context menu entry for the web page to translate highlighted text. A button in the browser's interface opens a pop-up in which the user can translate entered text or push a button to translate the whole page.
	
	\begin{table}[h]
		\centering
		\begin{tabular}{|l|l|l|} \hline
			\textbf{Content Script} & \textbf{Permissions} & \textbf{CSP} \\ \hline
			\url{<all_urls>} & activeTab & unsafe eval \\
			 & contextMenus & inline scripts from \url{https://translate.googleapis.com} \\
			& storage & \\ \hline
		\end{tabular}
		\caption{Google Translate - Extension's content and permissions.}
	\end{table}
	
	\begin{listing}
		\begin{itemize}
			\item  Read and change all your data on the websites you visit
		\end{itemize}
		\caption{Google Translate - Warnings shown on installation.}
	\end{listing}
	
	\begin{listing}
		\begin{itemize}
			\item Steal user data from every web page
			\item Store an persistent identifier
			\item Execute any remote loaded script
		\end{itemize}
		\caption{Google Translate - Possible attacks}
	\end{listing}
	
	The extension uses the combination of a non-persistent background page and the \texttt{activeTab} permission to inject a content script if the user clicks the extension's context menu entry. However, the extension still injects the same content script in every web page making the activeTab functionality useless. The content script and the JavaScript for the pop-up are compressed. Therefore, we could not provide accurate statements about the code's capabilities. We found the function \texttt{eval} used in a way to parse a JSON string to a JavaScript object: \texttt{eval("("+a+")")}. The compressed code restricted us to further investigate where the string parameter of the eval function originates, but we assume it is most likely loaded from a remote host. \\ %TODO remove
	
	\textbf{Proposals} To improve the security of the extension itself and its users we propose to remove the unnecessary automatic injection of the content script. The use of the activeTab permission increases the security for the user, because the extension is only active when the user invokes it. Furthermore, we propose to remove the eval function because it is a common source of Cross-Site-Scripting attacks. The parameter given to eval may either be a simple JSON object or a whole JavaScript as a string. Due to the compressed state of the code, we were not able to figure out which case applies. If only JSON objects are used, we propose the use of \texttt{JSON.parse()} as an alternative without the danger of possible Cross-Site-Scripting attacks. If the other case applies, the developers should consider if it is necessary for the extension's purpose to load remote scripts. If the loaded scripts are static, they should be placed inside the extension's installation bundle. \\ %TODO kick improve sec of exte
	
\section{Unlimited Free VPN - Hola}
	Hola provides a Virtual Private Network (VPN) as a free of charge extension. It routes the user's traffic through different countries to mask his true location. This allows to bypass regional restrictions on websites. A typical VPN network secures the web requests of its user's by routing the traffic to a few endpoints, masking the web request's origin. But Hola uses the devices of its unpaid customers to route traffic. It turns the user's computer into a VPN server and simultaneously to a VPN endpoint which means that the traffic of other users may exit through his Internet connection and take on his IP address. A Hola user's IP is therefore regularly exposed to the open Internet by traffic from other user's. The user himself has no possibility to control what content is loaded with his IP address as origin. The company makes money by providing the network to paying customers. Those are able to route their own traffic over the network to targeted endpoints. \\
	
	The paid functionality of Hola has strong similarities with a bot net which is used for denial of service or spmaming attacks. Actually, Hola recently received negative publicity as the owner of the web platform \textit{8chan} claimed that an attacker used the Hola network to perform a DDoS attack against his platform \cite{8chanHola}. Thereupon, researchers from the cyber security company \textit{Vectra}\footnote{Vectra Homepage: \url{http://www.vectranetworks.com/}} analyzed Hola's application and network. They discovered that Hola has - in addition to the public botnet-like functionality of routing huge amounts of targeted traffic - several features which may be used to perform further cyber attacks, such as download and execute any file while bypassing anti virus checking \cite{vectraHola}. \\ 
	
	\begin{table}[h]
		\centering
		\begin{tabular}{|l|l|l|} \hline
			\textbf{Content} & \textbf{Permissions} & \textbf{CSP} \\ \hline
			persistent background page & cookies & unsafe eval\\
			content script  \url{<all_urls>} & storage & inline scripts from 15 different URLs \\
			content script \url{*://*.hola.org/*} & tabs & \\ 
			& webNavigation & \\ 
			& webRequest & \\ 
			& webRequestBlocking & \\ 
			& \url{<all_urls>} & \\ \hline
		\end{tabular}
		\caption{Unlimited Free VPN - Hola - Extension's content and permissions}
	\end{table}
	
	\begin{listing}
		\begin{itemize}
			\item  Read and change all your data on the websites you visit
		\end{itemize}
		\caption{Unlimited Free VPN - Hola - Warnings shown on installation}
	\end{listing}
	
	Has to be active all the time => persistent background page. Needs to intercept web requests => webRequest API. 
	To many script sources.
	
\section{Evernote Web Clipper}
	
	\begin{table}[h]
		\centering
		\begin{tabular}{|l|l|l|} \hline
			\textbf{Content} & \textbf{Permissions} & \textbf{CSP} \\ \hline
			persistent background page & activeTab & inline scripts from  \\
			32 content scripts  \url{*://*/*} & contextMenus & \hspace{1em} \url{https://ssl.google-analytics.com} \\
			2 content scripts \url{*://*.salesforce.com/*} & cookies & \\ 
			content script \url{*://*.wsj.com/*} & notifications & \\ 
			& tabs & \\ 
			& unlimitedStorage & \\ 
			& \url{<all_urls>} & \\ 
			& \url{chrome://favicon/*} & \\ 
			& \url{http://*/*} & \\ 
			& \url{https://*/*} & \\ \hline
		\end{tabular}
		\caption{Evernote Web Clipper - Extension's content and permissions}
	\end{table}
	
	\begin{listing}
		\begin{itemize}
			\item  Read and change all your data on the websites you visit
		\end{itemize}
		\caption{Evernote Web Clipper - Warnings shown on installation}
	\end{listing}
